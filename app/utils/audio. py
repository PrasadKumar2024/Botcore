# ===============================
# WebRTC VAD (Real-time voice UX)
# ===============================

# app/utils/audio.py
try:
    import webrtcvad
    _HAS_WEBRTCVAD = True
except Exception:
    webrtcvad = None
    _HAS_WEBRTCVAD = False


class WebRTCVAD:
    def __init__(self, sample_rate: int = 16000, aggressiveness: int = 2):
        self.sample_rate = sample_rate
        if _HAS_WEBRTCVAD:
            self.vad = webrtcvad.Vad(aggressiveness)
        else:
            self.vad = None

    def is_speech(self, pcm: bytes) -> bool:
        if not self.vad:
            return True  # fallback: treat everything as speech
        return self.vad.is_speech(pcm, self.sample_rate)


def is_silence(pcm: bytes, vad: WebRTCVAD) -> bool:
    try:
        return not vad.is_speech(pcm)
    except Exception:
        return True

