<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bot Configuration - {{ client.business_name }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .bot-section {
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            background: #f8f9fa;
        }
        .subscription-buttons {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }
        .status-active {
            color: green;
            font-weight: bold;
        }
        .status-inactive {
            color: red;
            font-weight: bold;
        }
        .profile-section {
            background: white;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        .embed-code {
            background: #2d2d2d;
            color: #fff;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            word-break: break-all;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <!-- Header -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>Bot Configuration - {{ client.business_name }}</h1>
            <a href="/clients" class="btn btn-secondary">‚Üê Back to Clients</a>
        </div>

        <!-- WhatsApp Bot Section -->
        <div class="bot-section">
            <h3>üì± WhatsApp Bot</h3>
            <div class="row">
                <div class="col-md-6">
                    <p><strong>Phone Number:</strong> {{ phone_number if phone_number != "Not purchased" else "Not purchased" }}</p>
                    
                    <!-- Business Profile -->
                    <div class="profile-section">
                        <h5>Business Profile</h5>
                        <div class="mb-2">
                            <strong>Name:</strong> 
                            <span id="whatsapp-business-name">{{ client.business_name }}</span>
                            <button class="btn btn-sm btn-outline-primary ms-2" onclick="editField('whatsapp-business-name')">Edit</button>
                        </div>
                        <div class="mb-2">
                            <strong>Address:</strong> 
                            <span id="whatsapp-address">123 Main Street</span>
                            <button class="btn btn-sm btn-outline-primary ms-2" onclick="editField('whatsapp-address')">Edit</button>
                        </div>
                        <div class="mb-2">
                            <strong>Logo:</strong> 
                            <span id="whatsapp-logo">suresh-logo.png</span>
                            <button class="btn btn-sm btn-outline-primary ms-2" onclick="uploadLogo()">Change</button>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <!-- Subscription Section -->
                    <div class="profile-section">
                        <h5>Subscription</h5>
                        <div class="mb-2">
                            <strong>Start Date:</strong> <span id="whatsapp-start-date">--/--/----</span>
                        </div>
                        <div class="mb-2">
                            <strong>Expiry Date:</strong> <span id="whatsapp-expiry-date">--/--/----</span>
                        </div>
                        
                        <div class="subscription-buttons">
                            <button class="btn btn-outline-success" onclick="addMonths('whatsapp', 1)">1 Month</button>
                            <button class="btn btn-outline-success" onclick="addMonths('whatsapp', 2)">2 Months</button>
                            <button class="btn btn-outline-success" onclick="addMonths('whatsapp', 3)">3 Months</button>
                            <button class="btn btn-outline-success" onclick="addMonths('whatsapp', 6)">6 Months</button>
                            <button class="btn btn-outline-success" onclick="addMonths('whatsapp', 12)">12 Months</button>
                        </div>
                    </div>
                    
                    <!-- Status and Actions -->
                    <div class="mt-3">
                        <strong>Status:</strong> 
                        <span id="whatsapp-status" class="status-inactive">INACTIVE</span>
                        <div class="mt-2">
                            <button id="whatsapp-activate-btn" class="btn btn-success" onclick="toggleBot('whatsapp')">Activate WhatsApp Bot</button>
                            <button id="whatsapp-deactivate-btn" class="btn btn-danger" onclick="toggleBot('whatsapp')" style="display: none;">Deactivate WhatsApp Bot</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Voice Call Bot Section -->
        <div class="bot-section">
            <h3>üìû Voice Call Bot</h3>
            <div class="row">
                <div class="col-md-6">
                    <p><strong>Phone Number:</strong> {{ phone_number if phone_number != "Not purchased" else "Not purchased" }}</p>
                </div>
                
                <div class="col-md-6">
                    <!-- Subscription Section -->
                    <div class="profile-section">
                        <h5>Subscription</h5>
                        <div class="mb-2">
                            <strong>Start Date:</strong> <span id="voice-start-date">--/--/----</span>
                        </div>
                        <div class="mb-2">
                            <strong>Expiry Date:</strong> <span id="voice-expiry-date">--/--/----</span>
                        </div>
                        
                        <div class="subscription-buttons">
                            <button class="btn btn-outline-success" onclick="addMonths('voice', 1)">1 Month</button>
                            <button class="btn btn-outline-success" onclick="addMonths('voice', 2)">2 Months</button>
                            <button class="btn btn-outline-success" onclick="addMonths('voice', 3)">3 Months</button>
                            <button class="btn btn-outline-success" onclick="addMonths('voice', 6)">6 Months</button>
                            <button class="btn btn-outline-success" onclick="addMonths('voice', 12)">12 Months</button>
                        </div>
                    </div>
                    
                    <!-- Status and Actions -->
                    <div class="mt-3">
                        <strong>Status:</strong> 
                        <span id="voice-status" class="status-inactive">INACTIVE</span>
                        <div class="mt-2">
                            <button id="voice-activate-btn" class="btn btn-success" onclick="toggleBot('voice')">Activate Voice Bot</button>
                            <button id="voice-deactivate-btn" class="btn btn-danger" onclick="toggleBot('voice')" style="display: none;">Deactivate Voice Bot</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Web Chat Bot Section -->
        <div class="bot-section">
            <h3>üí¨ Web Chat Bot</h3>
            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <strong>Your Chatbot Link:</strong>
                        <div class="input-group mt-1">
                            <input type="text" class="form-control" id="chatbot-url" value="{{ chatbot_url }}" readonly>
                            <button class="btn btn-outline-secondary" onclick="copyToClipboard('chatbot-url')">Copy</button>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <strong>Embed Code:</strong>
                        <div class="embed-code mt-1" id="embed-code">
{{ embed_code }}
                        </div>
                        <button class="btn btn-outline-primary mt-2" onclick="copyToClipboard('embed-code')">Copy Embed Code</button>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <!-- Subscription Section -->
                    <div class="profile-section">
                        <h5>Subscription</h5>
                        <div class="mb-2">
                            <strong>Start Date:</strong> <span id="web-start-date">--/--/----</span>
                        </div>
                        <div class="mb-2">
                            <strong>Expiry Date:</strong> <span id="web-expiry-date">--/--/----</span>
                        </div>
                        
                        <div class="subscription-buttons">
                            <button class="btn btn-outline-success" onclick="addMonths('web', 1)">1 Month</button>
                            <button class="btn btn-outline-success" onclick="addMonths('web', 2)">2 Months</button>
                            <button class="btn btn-outline-success" onclick="addMonths('web', 3)">3 Months</button>
                            <button class="btn btn-outline-success" onclick="addMonths('web', 6)">6 Months</button>
                            <button class="btn btn-outline-success" onclick="addMonths('web', 12)">12 Months</button>
                        </div>
                    </div>
                    
                    <!-- Status and Actions -->
                    <div class="mt-3">
                        <strong>Status:</strong> 
                        <span id="web-status" class="status-inactive">INACTIVE</span>
                        <div class="mt-2">
                            <button id="web-activate-btn" class="btn btn-success" onclick="toggleBot('web')">Activate Web Chat</button>
                            <button id="web-deactivate-btn" class="btn btn-danger" onclick="toggleBot('web')" style="display: none;">Deactivate Web Chat</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <div class="d-flex justify-content-between mt-4">
            <a href="/skip_number" class="btn btn-secondary">‚Üê Previous</a>
            <a href="/clients" class="btn btn-primary">Finish Setup</a>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Edit field functionality
        function editField(fieldId) {
            const field = document.getElementById(fieldId);
            const currentValue = field.textContent;
            const newValue = prompt(`Edit ${fieldId.replace('-', ' ')}:`, currentValue);
            if (newValue !== null) {
                field.textContent = newValue;
                // Here you would typically send this to your backend
                console.log(`Updated ${fieldId} to:`, newValue);
            }
        }

        // Upload logo functionality
        function uploadLogo() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    document.getElementById('whatsapp-logo').textContent = file.name;
                    // Here you would typically upload the file to your backend
                    console.log('Logo file selected:', file.name);
                }
            };
            input.click();
        }

        // Copy to clipboard functionality
        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            let text = element.value || element.textContent;
            
            navigator.clipboard.writeText(text).then(function() {
                alert('Copied to clipboard!');
            }, function(err) {
                console.error('Could not copy text: ', err);
            });
        }

        // Add months subscription functionality
        function addMonths(botType, months) {
            if (confirm(`Add ${months} month(s) to ${botType} bot?`)) {
                // Here you would call your backend API to add months
                console.log(`Adding ${months} months to ${botType} bot`);
                
                // Update dates (this is just frontend simulation - real data should come from backend)
                const today = new Date();
                const startDateElement = document.getElementById(`${botType}-start-date`);
                const expiryDateElement = document.getElementById(`${botType}-expiry-date`);
                
                // If no start date set, set it to today
                if (startDateElement.textContent === '--/--/----') {
                    startDateElement.textContent = today.toLocaleDateString();
                }
                
                // Calculate new expiry date
                const currentExpiry = expiryDateElement.textContent === '--/--/----' ? today : new Date(expiryDateElement.textContent);
                const newExpiry = new Date(currentExpiry);
                newExpiry.setMonth(newExpiry.getMonth() + months);
                
                expiryDateElement.textContent = newExpiry.toLocaleDateString();
                
                alert(`${months} month(s) added to ${botType} bot!`);
            }
        }

        // Toggle bot activation
        function toggleBot(botType) {
            const statusElement = document.getElementById(`${botType}-status`);
            const activateBtn = document.getElementById(`${botType}-activate-btn`);
            const deactivateBtn = document.getElementById(`${botType}-deactivate-btn`);
            
            if (statusElement.classList.contains('status-inactive')) {
                // Check if subscription is active
                const expiryDate = document.getElementById(`${botType}-expiry-date`).textContent;
                if (expiryDate === '--/--/----') {
                    alert('Please add subscription months first!');
                    return;
                }
                
                // Activate bot
                statusElement.textContent = 'ACTIVE';
                statusElement.classList.remove('status-inactive');
                statusElement.classList.add('status-active');
                activateBtn.style.display = 'none';
                deactivateBtn.style.display = 'inline-block';
                
                console.log(`${botType} bot activated`);
            } else {
                // Deactivate bot
                statusElement.textContent = 'INACTIVE';
                statusElement.classList.remove('status-active');
                statusElement.classList.add('status-inactive');
                activateBtn.style.display = 'inline-block';
                deactivateBtn.style.display = 'none';
                
                console.log(`${botType} bot deactivated`);
            }
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Bot configuration page loaded for client:', '{{ client.business_name }}');
        });
    </script>
</body>
</html>
